<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link type="text/css" rel="stylesheet" href="docs/css/active4d.css">
        <link type="text/css" rel="stylesheet" href="docs/css/main.css">
        <title>fxCanvas - HTML5 Canvas element for Internet Explorer</title>
    </head>
    <body>
        <p> <a href="http://code.google.com/p/fxcanvas/"><img src="docs/images/fxcanvas.png" /></a> <h2>About</h2></p><p>fxCanvas is an implementation of HTML5 Canvas element for Internet Explorer (two-dimensional graphics only).</p><p><strong>Notice:</strong> you have to update <a href="http://get.adobe.com/flashplayer/">flash player</a> to enable fxCanvas in Internet Explorer (some versions from 10.1 branch does not properly work with it, see <a href="http://code.google.com/p/fxcanvas/issues/detail?id=5">Issue 5</a>). <h2>Usage</h2></p><p>You have to download <a href="http://code.google.com/p/fxcanvas/downloads/detail?name=fxcanvas-0.2(beta1)-supersonic.zip">package</a>, unpack it in public directory then paste in head section of the page following code:</p><pre class="active4d code-block">
<span class="TagContainer"><span class="TagContainer">&lt;</span><span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> <span class="TagAttribute">src</span>=<span class="String"><span class="String">&quot;</span>/public/path/jooscript.js<span class="String">&quot;</span></span><span class="TagContainer">&gt;<span class="TagContainer">&lt;</span>/</span><span class="TagName">script</span><span class="TagContainer">&gt;</span></span>
<span class="TagContainer"><span class="TagContainer">&lt;</span><span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> <span class="TagAttribute">src</span>=<span class="String"><span class="String">&quot;</span>/public/path/fxcanvas.js<span class="String">&quot;</span></span><span class="TagContainer">&gt;<span class="TagContainer">&lt;</span>/</span><span class="TagName">script</span><span class="TagContainer">&gt;</span></span>
<span class="BlockComment"><span class="BlockComment">&lt;!--</span>[if IE]&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;/public/path/flash_backend.js&quot;&gt;&lt;/script&gt;&lt;![endif]<span class="BlockComment">--&gt;</span></span>
<span class="TagContainer"><span class="TagContainer">&lt;</span><span class="TagName">comment</span><span class="TagContainer">&gt;</span></span><span class="TagContainer"><span class="TagContainer">&lt;</span><span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span> <span class="TagAttribute">src</span>=<span class="String"><span class="String">&quot;</span>/public/path/canvas_backend.js<span class="String">&quot;</span></span><span class="TagContainer">&gt;<span class="TagContainer">&lt;</span>/</span><span class="TagName">script</span><span class="TagContainer">&gt;</span></span><span class="TagContainer"><span class="TagContainer">&lt;/</span><span class="TagName">comment</span><span class="TagContainer">&gt;</span></span>
</pre><p>If you are not familiar with Canvas API, it may be useful to read this: <ul> <li style="list-style-image:url(docs/images/moz.ico);"><a href="https://developer.mozilla.org/en/HTML/Canvas">Canvas tutorial on Mozzila.org</a></li> <li style="list-style-image:url(docs/images/opera.ico);"><a href="http://dev.opera.com/articles/view/html-5-canvas-the-basics/">... on dev.Opera.com</a></li> </ul></p><p><strong>New!</strong> Images and text are now <a href="tests/test_clip.html">clipable</a>.</p><p>fxCanvas also works properly with <code>data:</code> URIs in Internet Explorer. <a href="tests/image_data_example.html">Code sample</a>. <h2>Compatibility</h2></p><p>fxCanvas supports almost all the Canvas features.  The differences is in:</p><p><strong> Invoke command and chaining operations </strong></p><p>Context commands are keeping in a buffer before they will be applyed, so that to get values you must use method <code>invoke()</code>:</p><pre class="active4d code-block">
&lt;<span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span>&gt;
    <span class="Storage">var</span> cv <span class="Operator">=</span> <span class="LibraryClassType">document</span>.<span class="CommandMethod">getElementById</span>(<span class="String"><span class="String">&quot;</span>cv<span class="String">&quot;</span></span>);
    <span class="Storage">var</span> ctx <span class="Operator">=</span> cv.getContext(<span class="String"><span class="String">&quot;</span>2d<span class="String">&quot;</span></span>);
    ctx.setFillStyle(<span class="String"><span class="String">&quot;</span>#ff0<span class="String">&quot;</span></span>)
        .setStrokeStyle(<span class="String"><span class="String">&quot;</span>#0ff<span class="String">&quot;</span></span>)
        .strokeRect(<span class="Number">10</span>, <span class="Number">20</span>, <span class="Number">30</span>, <span class="Number">30</span>)
        .fillRect(<span class="Number">30</span>, <span class="Number">40</span>, <span class="Number">50</span>, <span class="Number">50</span>)
        .invoke(<span class="String"><span class="String">&quot;</span>getImageData<span class="String">&quot;</span></span>, <span class="Number">0</span>, <span class="Number">0</span>, cv.<span class="NamedConstant">width</span>, cv.<span class="NamedConstant">height</span>, <span class="Storage">function</span> (<span class="FunctionArgument">imageData</span>) {
            <span class="LineComment"><span class="LineComment">//</span> ... processing image data</span>
        });
&lt;/<span class="TagName">script</span>&gt;
</pre>
 
<strong> Images </strong><p>Prior to using images you must preload them:</p><pre class="active4d code-block">
&lt;<span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span>&gt;
    <span class="Storage">var</span> cv <span class="Operator">=</span> <span class="LibraryClassType">document</span>.<span class="CommandMethod">getElementById</span>(<span class="String"><span class="String">&quot;</span>cv<span class="String">&quot;</span></span>);
    <span class="Storage">var</span> ctx <span class="Operator">=</span> cv.getContext(<span class="String"><span class="String">&quot;</span>2d<span class="String">&quot;</span></span>);
    <span class="Storage">var</span> image_src <span class="Operator">=</span> <span class="String"><span class="String">&quot;</span>sample.jpg<span class="String">&quot;</span></span>;
    <span class="LibraryClassType">cv</span>.<span class="FunctionName">onload</span> = <span class="Storage">function</span>(<span class="FunctionArgument">img</span>) {
        <span class="Keyword">if</span> (img.<span class="NamedConstant">src</span>.<span class="CommandMethod">indexOf</span>(image_src) <span class="Operator">&gt;</span> <span class="Operator">-</span><span class="Number">1</span>) {
            ctx.drawImage(img, <span class="Number">10</span>, <span class="Number">10</span>);
        }
    }
    cv.loadImage(image_src <span class="BlockComment"><span class="BlockComment">/*</span> ... img1, img2, ... imgX <span class="BlockComment">*/</span></span>);
&lt;/<span class="TagName">script</span>&gt;
</pre>
 
<strong> Image data array </strong><p>We cannot use canvas image data as it declared in specs, because of IE using extremely ineffective memory manager so it may eats all available memory in some circumstances. So that fxCanvas is using slightly different image data format. </p><p>Take a look at example:</p><pre class="active4d code-block">
&lt;<span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span>&gt;
    <span class="Storage">var</span> cv <span class="Operator">=</span> <span class="LibraryClassType">document</span>.<span class="CommandMethod">getElementById</span>(<span class="String"><span class="String">&quot;</span>cv<span class="String">&quot;</span></span>);
    <span class="Storage">var</span> ctx <span class="Operator">=</span> cv.getContext(<span class="String"><span class="String">&quot;</span>2d<span class="String">&quot;</span></span>);
    ctx.invoke(<span class="String"><span class="String">&quot;</span>getImageData<span class="String">&quot;</span></span>, <span class="Number">0</span>, <span class="Number">0</span>, cv.<span class="NamedConstant">width</span>, cv.<span class="NamedConstant">height</span>, <span class="Storage">function</span>(buf) {
        <span class="Keyword">for</span> (<span class="Storage">var</span> y <span class="Operator">=</span> <span class="Number">0</span>; y <span class="Operator">&lt;</span> cv.<span class="NamedConstant">height</span>; y<span class="Operator">++</span>) {
           <span class="Keyword">for</span> (<span class="Storage">var</span> x <span class="Operator">=</span> <span class="Number">0</span>; x <span class="Operator">&lt;</span> cv.<span class="NamedConstant">width</span>; x<span class="Operator">++</span>) {
               <span class="Storage">var</span> ofs <span class="Operator">=</span> y <span class="Operator">*</span> cv.<span class="NamedConstant">width</span> <span class="Operator">+</span> x,
                   pixelValue <span class="Operator">=</span> buf.<span class="NamedConstant">data</span>[ofs], <span class="LineComment"><span class="LineComment">//</span> pixel value is 32-bit integer</span>
                   red <span class="Operator">=</span> pixelValue <span class="Operator">&gt;</span><span class="Operator">&gt;</span> <span class="Number">24</span> <span class="Operator">&amp;</span> <span class="Number">0xFF</span>,
                   green <span class="Operator">=</span> pixelValue <span class="Operator">&gt;</span><span class="Operator">&gt;</span> <span class="Number">16</span> <span class="Operator">&amp;</span> <span class="Number">0xFF</span>,
                   blue <span class="Operator">=</span> pixelValue <span class="Operator">&gt;</span><span class="Operator">&gt;</span> <span class="Number">8</span> <span class="Operator">&amp;</span> <span class="Number">0xFF</span>,
                   alpha <span class="Operator">=</span> pixelValue <span class="Operator">&amp;</span> <span class="Number">0xFF</span>;
               <span class="LineComment"><span class="LineComment">//</span> </span>
               <span class="LineComment"><span class="LineComment">//</span> exchange color channels</span>
               buf.<span class="NamedConstant">data</span>[ofs] <span class="Operator">=</span> (blue <span class="Operator">&lt;</span><span class="Operator">&lt;</span> <span class="Number">24</span>) <span class="Operator">+</span> (red <span class="Operator">&lt;</span><span class="Operator">&lt;</span> <span class="Number">16</span>) <span class="Operator">+</span> (green <span class="Operator">&lt;</span><span class="Operator">&lt;</span> <span class="Number">8</span>) <span class="Operator">+</span> alpha;
            }
        }
        ctx.invoke(<span class="String"><span class="String">&quot;</span>putImageData<span class="String">&quot;</span></span>, buf, <span class="Number">0</span>, <span class="Number">0</span>, <span class="Storage">function</span>(){
            <span class="LineComment"><span class="LineComment">//</span> ... print out the buffer after the operation will be completed</span>
            <span class="TypeName">console</span><span class="CommandMethod">.log</span>(<span class="String"><span class="String">&quot;</span>Image data dump:<span class="String">&quot;</span></span> <span class="Operator">+</span> buf); 
        }
    });
&lt;/<span class="TagName">script</span>&gt;
</pre><p>Further explanation can be founded <a href="tests/data-structure-comparison.html">here</a>.</p><p><strong> isPointInPath() </strong></p><p><code>isPointInPath()</code> in Internet Explorer returns <code>true</code> if point in bounding box of the path.</p><p><strong> toDataURL() </strong></p><p>To get canvas shot you must call the function with data handler:</p><pre class="active4d code-block">
&lt;<span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span>&gt;
    <span class="Storage">var</span> cv <span class="Operator">=</span> <span class="LibraryClassType">document</span>.<span class="CommandMethod">getElementById</span>(<span class="String"><span class="String">&quot;</span>cv<span class="String">&quot;</span></span>);
    <span class="Storage">var</span> type <span class="Operator">=</span> <span class="String"><span class="String">&quot;</span>image/jpeg<span class="String">&quot;</span></span>, quality <span class="Operator">=</span> .<span class="Number">4</span>; <span class="LineComment"><span class="LineComment">//</span> quality is optional argument</span>
    cv.toDataURL(type, quality, <span class="Storage">function</span> (<span class="FunctionArgument">png_data</span>) {
        <span class="LineComment"><span class="LineComment">//</span> draw slice of the canvas on the same canvas at top right corner</span>
        <span class="Storage">var</span> ctx <span class="Operator">=</span> <span class="Variable">this</span>.getContext(<span class="String"><span class="String">&quot;</span>2d<span class="String">&quot;</span></span>);
        <span class="LibraryClassType">this</span>.<span class="FunctionName">onload</span> = <span class="Storage">function</span> (<span class="FunctionArgument">img</span>) {
            ctx.drawImage(img, <span class="Number">0</span>, <span class="Number">0</span>, cv.<span class="NamedConstant">width</span> <span class="Operator">-</span> <span class="Number">100</span>, <span class="Number">0</span>, <span class="Number">100</span>, <span class="Number">100</span>);
        }
        <span class="Variable">this</span>.loadImage(png_data);
    });
&lt;/<span class="TagName">script</span>&gt;
</pre><p>Possible types: <code>image/png</code>, <code>image/jpeg</code>, <strike><code>image/svg+xml</code></strike>.</p><p><strong> Animation </strong></p><p>There are two ways to making animation on Canvas. First case is using <code>setInterval()</code>, second case is using <code>onframe</code> event:</p><pre class="active4d code-block">
&lt;<span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span>&gt;
    <span class="Storage">var</span> ctx <span class="Operator">=</span> <span class="LibraryClassType">document</span>.<span class="CommandMethod">getElementById</span>(<span class="String"><span class="String">&quot;</span>cv<span class="String">&quot;</span></span>).getContext(<span class="String"><span class="String">&quot;</span>2d<span class="String">&quot;</span></span>);
    <span class="BlockComment"><span class="BlockComment">/*</span></span>
<span class="BlockComment">     * variant one</span>
<span class="BlockComment">     <span class="BlockComment">*/</span></span>
    <span class="CommandMethod">setInterval</span>(<span class="Storage">function</span>() {
        <span class="LineComment"><span class="LineComment">//</span> ... frame drawing routine</span>
    }, <span class="Number">1000</span>);
    <span class="BlockComment"><span class="BlockComment">/*</span></span>
<span class="BlockComment">     * variant two</span>
<span class="BlockComment">     <span class="BlockComment">*/</span></span>
    ctx.canvas.frameDuration <span class="Operator">=</span> <span class="Number">10</span>; <span class="LineComment"><span class="LineComment">//</span> in microseconds</span>
    <span class="LibraryClassType">ctx.canvas</span>.<span class="FunctionName">onframe</span> = <span class="Storage">function</span>(){ <span class="LineComment"><span class="LineComment">//</span> frame event handler will fired with interval in 10ms</span>
        <span class="LineComment"><span class="LineComment">//</span> ... frame drawing routine</span>
    };
    <span class="LineComment"><span class="LineComment">//</span> Warning: animations with complex graphics and tiny frameDuration value may hang on the browser!</span>
&lt;/<span class="TagName">script</span>&gt;
</pre><p>Using <code>onframe</code> event is strongly encouraged, as in Internet Explorer animation running on <code>setInterval()</code> will show incorrect frame rate.</p><p>Note: <code>onframe</code> event is non-standard extension.</p><p><strong> How-to create Canvas element in script </strong></p><p>The simpliest way to dynamically create canvas element is:</p><pre class="active4d code-block">
&lt;<span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span>&gt;
    <span class="Storage">var</span> cv <span class="Operator">=</span> <span class="LibraryClassType">document</span>.<span class="CommandMethod">createElement</span>(<span class="String"><span class="String">&quot;</span>canvas<span class="String">&quot;</span></span>);
    cv.<span class="NamedConstant">width</span> <span class="Operator">=</span> <span class="Number">200</span>;
    cv.<span class="NamedConstant">height</span> <span class="Operator">=</span> <span class="Number">100</span>;
    <span class="LibraryClassType">document</span>.<span class="NamedConstant">body</span>.<span class="CommandMethod">appendChild</span>(cv);
    <span class="LineComment"><span class="LineComment">//</span> ...</span>
&lt;/<span class="TagName">script</span>&gt;
</pre><p>Note that if fxCanvas lib is loaded then in newly created elements will be using extended context by default.  To disable this behavior and manually initialize fxcanvas context, use following code:</p><pre class="active4d code-block">
&lt;<span class="TagName">script</span> <span class="TagAttribute">type</span>=<span class="String"><span class="String">&quot;</span>text/javascript<span class="String">&quot;</span></span>&gt;
    <span class="Operator">$</span>Import(<span class="String"><span class="String">&quot;</span>buz.fxcanvas<span class="String">&quot;</span></span>);
    <span class="LineComment"><span class="LineComment">//</span> don't forget to disable fxCanvas before page content will loaded</span>
    fxcanvas.config.enable <span class="Operator">=</span> <span class="BuiltInConstant">false</span>;
    <span class="LibraryClassType">window</span>.<span class="FunctionName">onload</span> = <span class="Storage">function</span>(){
        <span class="Storage">var</span> cv <span class="Operator">=</span> <span class="LibraryClassType">document</span>.<span class="CommandMethod">createElement</span>(<span class="String"><span class="String">&quot;</span>canvas<span class="String">&quot;</span></span>);
        fxcanvas.initElement(cv)
        <span class="LineComment"><span class="LineComment">//</span> ...</span>
&lt;/<span class="TagName">script</span>&gt;
</pre><p><strong> Context and Backend </strong></p><p>There are a few two-dimensional Canvas contexts: extended via <code>canvas.getContext("2d")</code> and original via <code>canvas.getBackend("2d")</code>. Use last one if you want native drawing speed.</p><p><strong> Composite operations </strong></p><p>Only <code>source-over</code> and <code>lighter</code> are supported. <h2>Demos and examples</h2></p><ul><li><a href="tests/drawarea.html">Drawarea</a></li><li><a href="tests/image_data_example.html">Using image data example</a></li><li><a href="demo/index.html">all demos</a>...</li><li><a href="tests/index.html">all tests and examples</a>...</li></ul>
<h2>Source</h2><p><a href="http://code.google.com/p/fxcanvas/downloads/detail?name=fxcanvas-0.2(beta1)-supersonic.zip">Download source</a> or <a href="http://code.google.com/p/fxcanvas/source/checkout">grab trunk from SVN</a>. <h2>Volunteers wanted! Couple of impossible tasks are there (TODO):</h2></p><ul><li>rewrite Cubic Bezier Curves approximation algorithm;</li><li>rewrite arcs drawing algorithm (see <a href="tests/canvas-rounded-corners.html">this bug</a>);</li><li>stroke to path conversion (=> patterns on strokes, strokeText() etc..);</li><li>improve <code>isPointInPath()</code>;</li><li>improve text API;</li><li>improve drawImage: <strike><code>drawImage(canvasElement, ...)</code></strike>, <code>drawImage(videoElement, ...)</code>;</li><li>Canvas to SVG converter, <code>toDataURL("image/xml+svg")</code>;</li><li>composite operations;</li><li>shadows;</li></ul>
 <h2>References</h2><ul><li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html">WHATWG Canvas spec</a>.</li><li>fxCanvas is a fork of <a href="http://code.google.com/p/flashcanvas/">flashcanvas</a>.</li><li><a href="http://flashcanvas.net">FlashCanvas Pro</a> offers commercial support.</li></ul>
<h2>Bugs and feedbacks</h2>
 
<ul><li><a href="http://code.google.com/p/fxcanvas/issues/list">Issue tracker</a></li><li><a href="http://groups.google.com/group/fxcanvas">Discussion group</a></li></ul><h2>What's up</h2><h3>fxCanvas 0.2 (beta1) - Super Sonic - (2010-11-12)</h3><p><img src="docs/images/super_sonic.gif" />    <ul><li>Changed image data format, now it is array with length = image width <code>x</code> height where element is pixel value encoded in 32-bit integer. <a href="tests/data-structure-comparison.html">Data structure comparison</a>.</li><li>Experimental implementation of reusable Canvas path.</li><li>(IE) Images and text are now <a href="tests/test_clip.html">clipable</a>.</li><li>(IE) Improved Canvas Text API.</li><li>(IE) Rewritten initialization routine.</li><li>(IE) Some optimizations in Flash backend.</li><li>(IE) Basic implementation of method <code>drawImage([Canvas element], ...)</code>.</li></ul> <h3>fxCanvas 0.15d - Super Mario - (2010-05-26)</h3></p><ul><li>Fixed extended context in modest browser (Chrome, Firefox and company).</li></ul>
<h3>fxCanvas 0.15c - Super Mario - (2010-05-01)</h3><p><img src="docs/images/hum14o.jpg" /></p><ul><li><i>Opera</i>: added stub in <code>createImageData()</code>;</li><li><i>Internet Explorer</i>: added configurable brand new context menu;</li><li>..... and freeing (right-) click event;</li><li>..... and now mouse behavior similar to standard-compliant browsers;</li><li>released extended canvas context (window.extCanvasRenderingContext2D), reasons: in some browsers native rendering context is not extendable;</li><li>solved animation interval problem, as a solution introduced canvas parameters <code>onframe</code> and <code>frameDuration</code>;</li><li>new, clear project structure;</li><li>the code splitting into IE and non-IE part;</li><li>fixed <code>HTMLCanvasElement</code> and <code>CanvasRenderingContext2D</code> in Internet Explorer;</li><li>as usual cleaned the code up and small optimizations;</li><li>... some other minor updates;</li></ul>
  <h3>fxCanvas 0.1a - Mario - (2010-04-14)</h3><p><img src="docs/images/mario2.png" />    <ul><li>Fixed probably all stupid bugs.</li><li>Support of basic text API. (Thanks Fabien!)</li><li>Image data support. (Thanks jamie!)</li><li>Fixed isPointInPath() (on JS side).</li><li>Fixed extended context in Safari 3.</li><li>Clean up and code optimizations.</li><li>Flash exceptions handling.</li><li>drawImage chews Base64-encoded images and Canvas element.</li><li>Sync with flashcanvas trunk.</li><li>and other positive changes ...</li></ul></p><p><a href="http://code.google.com/p/fxcanvas/downloads/detail?name=fxcanvas-0.2(beta1)-supersonic.zip">Download source</a> (don't forget to file an <a href="http://code.google.com/p/fxcanvas/issues/list">issue</a> when you find something bad).</p>
    </body>
</html>
